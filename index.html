<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kebab O'Clock</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* Your existing CSS remains the same */
    </style>
</head>
<body class="bg-[#121212] text-white">
    <!-- Your existing HTML structure remains the same until the script section -->
    
    <script>
        // Cart functionality
        let cart = [];
        const cartButton = document.getElementById('cart-button');
        const closeCart = document.getElementById('close-cart');
        const cartDrawer = document.querySelector('.cart-drawer');
        const overlay = document.querySelector('.overlay');
        const cartItems = document.getElementById('cart-items');
        const cartSubtotal = document.getElementById('cart-subtotal');
        const cartCount = document.getElementById('cart-count');
        const menuContainer = document.getElementById('menu-container');
        const searchInput = document.getElementById('search-input');
        const tagFilters = document.querySelectorAll('.tag-filter');
        const checkoutButton = document.getElementById('checkout-button');
        const orderNowButton = document.getElementById('order-now-btn');
        const mainContent = document.getElementById('main-content');
        const checkoutPage = document.getElementById('checkout-page');
        const backToMenuButton = document.getElementById('back-to-menu');
        const checkoutItems = document.getElementById('checkout-items');
        const checkoutTotal = document.getElementById('checkout-total');
        const placeOrderButton = document.getElementById('place-order-btn');
        const checkoutForm = document.getElementById('checkout-form');
        const orderTypeSelect = document.getElementById('order-type');
        const deliveryAddressField = document.getElementById('delivery-address-field');
        const deliveryAddress = document.getElementById('delivery-address');
        const orderConfirmation = document.getElementById('order-confirmation');
        const confirmOkButton = document.getElementById('confirm-ok');

        // Load menu items from JSON files
        async function loadMenuItems() {
            try {
                const fileNames = ['burgers.json', 'wraps.json', 'doners.json', 'sides.json', 'drinks.json'];
                const fetchPromises = fileNames.map(fileName => 
                    fetch(`/${fileName}`).then(response => response.json())
                );
                
                const results = await Promise.all(fetchPromises);
                let allItems = [];
                
                results.forEach(data => {
                    if (data && data.items) {
                        allItems = allItems.concat(data.items);
                    }
                });
                
                renderMenuItems(allItems);
            } catch (error) {
                console.error('Error loading menu items:', error);
                menuContainer.innerHTML = '<p class="text-center text-gray-400 col-span-full py-8 text-lg">Error loading menu. Please try again later.</p>';
            }
        }

        // Render menu items to the page
        function renderMenuItems(items) {
            menuContainer.innerHTML = '';
            
            if (items.length === 0) {
                menuContainer.innerHTML = '<p class="text-center text-gray-400 col-span-full py-8 text-lg">No menu items found matching your criteria.</p>';
                return;
            }
            
            items.forEach(item => {
                const article = document.createElement('article');
                article.className = 'bg-[#1a1a1a] rounded-lg overflow-hidden shadow-md text-base menu-item-card';
                
                // Use relative paths for images
                const imagePath = `/images/${item.image}`;
                
                article.innerHTML = `
                    <div class="relative">
                        <img alt="${item.name}" class="w-full h-48 object-cover" src="${imagePath}">
                        <span class="absolute top-3 left-3 bg-[#ff6a00] text-xs font-semibold uppercase rounded px-2 py-1">
                            ${item.tags[0]}
                        </span>
                    </div>
                    <div class="p-4">
                        <h4 class="font-semibold text-white mb-2 text-lg">${item.name}</h4>
                        <p class="text-gray-400 mb-3 text-sm">${item.description}</p>
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-[#ff6a00] font-semibold text-lg">£${item.price.toFixed(2)}</span>
                        </div>
                        <div class="flex flex-col gap-3">
                            <button class="add-to-cart-base w-full bg-[#ff6a00] text-white font-semibold rounded-lg py-2 hover:bg-[#e05a00] flex items-center justify-center space-x-2" 
                                data-name="${item.name}" data-price="${item.price}">
                                <i class="fas fa-shopping-cart"></i>
                                <span>Add to Cart (£${item.price.toFixed(2)})</span>
                            </button>
                            <button class="add-to-cart-meal w-full bg-[#1a1a1a] border border-[#ff6a00] text-[#ff6a00] font-semibold rounded-lg py-2 hover:bg-[#ff6a00] hover:text-black flex items-center justify-center space-x-2" 
                                data-name="${item.name}" data-price="${item.price + item.mealPriceModifier}">
                                <i class="fas fa-utensils"></i>
                                <span>Make it a Meal (£${(item.price + item.mealPriceModifier).toFixed(2)})</span>
                            </button>
                        </div>
                    </div>
                `;
                
                menuContainer.appendChild(article);
            });
            
            // Add event listeners to the new buttons
            document.querySelectorAll('.add-to-cart-base').forEach(button => {
                button.addEventListener('click', (e) => {
                    const name = e.currentTarget.getAttribute('data-name');
                    const price = parseFloat(e.currentTarget.getAttribute('data-price'));
                    addToCart(name, price, false);
                });
            });
            
            document.querySelectorAll('.add-to-cart-meal').forEach(button => {
                button.addEventListener('click', (e) => {
                    const name = e.currentTarget.getAttribute('data-name');
                    const price = parseFloat(e.currentTarget.getAttribute('data-price'));
                    addToCart(name, price, true);
                });
            });
        }

        // Filter menu items based on search and tags
        async function filterMenuItems() {
            try {
                const searchTerm = searchInput.value.toLowerCase();
                const activeTag = document.querySelector('.tag-filter.active')?.getAttribute('data-tag') || 'all';
                
                const fileNames = ['burgers.json', 'wraps.json', 'doners.json', 'sides.json', 'drinks.json'];
                const fetchPromises = fileNames.map(fileName => 
                    fetch(`/${fileName}`).then(response => response.json())
                );
                
                const results = await Promise.all(fetchPromises);
                let allItems = [];
                
                results.forEach(data => {
                    if (data && data.items) {
                        allItems = allItems.concat(data.items);
                    }
                });
                
                let filteredItems = allItems.filter(item => {
                    const matchesSearch = item.name.toLowerCase().includes(searchTerm) || 
                                        item.description.toLowerCase().includes(searchTerm);
                    
                    const matchesTag = activeTag === 'all' || item.tags.includes(activeTag);
                    
                    return matchesSearch && matchesTag;
                });
                
                renderMenuItems(filteredItems);
            } catch (error) {
                console.error('Error filtering menu items:', error);
            }
        }

        // The rest of your functions (addToCart, openCartDrawer, etc.) remain the same
        // ...

        // Initialize the page
        function init() {
            // Load menu items
            loadMenuItems();
            
            // Event listeners
            cartButton.addEventListener('click', openCartDrawer);
            closeCart.addEventListener('click', closeCartDrawer);
            overlay.addEventListener('click', closeCartDrawer);
            
            // Search and filter events
            searchInput.addEventListener('input', filterMenuItems);
            
            tagFilters.forEach(filter => {
                filter.addEventListener('click', () => {
                    tagFilters.forEach(f => f.classList.remove('active'));
                    filter.classList.add('active');
                    filterMenuItems();
                });
            });
            
            // Checkout events
            checkoutButton.addEventListener('click', showCheckoutPage);
            orderNowButton.addEventListener('click', showCheckoutPage);
            backToMenuButton.addEventListener('click', showMainContent);
            
            // Order type event
            orderTypeSelect.addEventListener('change', handleOrderTypeChange);
            
            // Form submission
            checkoutForm.addEventListener('submit', handleFormSubmit);
            
            // Confirmation button
            confirmOkButton.addEventListener('click', () => {
                orderConfirmation.classList.add('hidden');
                showMainContent();
                cart = [];
                updateCart();
                checkoutForm.reset();
            });
            
            // Set initial active filter
            document.querySelector('[data-tag="all"]').classList.add('active');
        }

        // Run initialization when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
